---

- hosts: all
  tags: always
  roles:
    - role: mirrorlist
    - role: partition
      partition_mountpoint: '{{ target_dir }}'
    - role: pacstrap
    - role: arch-chroot
      chroot_mnt: '{{ target_dir }}'

- import_playbook: archsible.yml
  vars:
    ansible_connection: chroot
    ansible_host: '{{ target_dir }}'

- import_playbook: optimize_box.yml
  when: packer_build_name is defined
  vars:
    ansible_connection: chroot
    ansible_host: '{{ target_dir }}'
