---
# tasks file for mount

- name: Mounting partitions to mountpoint directory
  mount:
    src: "{{ _mount_dev }}"
    path: "{{ mount_mountpoint }}{{ item.mountpoint }}"
    fstype: '{{ item.fstype }}'
    opts: '{{ item.opts }}'
    state: mounted
  with_items:
    '{{ mount_list | sort(attribute="mountpoint") }}'
  loop_control:
    label: '{{ _mount_dev }}'

- name: Ensure etc directory exits
  file:
    path: '{{ mount_mountpoint }}/etc'
    state: directory

- name: Generate the filesystem table
  command: '/usr/bin/genfstab -p -t UUID {{ mount_mountpoint }}'
  register: _mount_genfstab
  changed_when: false
  check_mode: false

- name: Write the filesystem table
  copy:
    content: |
      {{ _mount_genfstab.stdout }}
    dest: '{{ mount_mountpoint }}/etc/fstab'
